/**********************************

	This handles multi input fields
	in custom meta...
	
	It allows the user to add multiple
	items in the same meta and pipes 
	the items into one input

**********************************/function set_up_form(){var e=jQuery,t=e(".multi-input input"),n=e.parseJSON(t.attr("data-fields"));e.each(t,function(t,n){var r=e(n).attr("id");process_current_fields({field_id:r,element:n});e(this).parent().append('<a href="javascript:add_empty_fields({unique:undefined});">Add New</a>')})}function add_empty_fields(e){var t=e.unique,n=e.location?e.location:"",r=jQuery,i=r(".multi-input"),s=r(".multi-input-field").attr("data-fields"),o=r.parseJSON(convert_to_quotes(s)),u="",a="",f='<div style="border:1px solid #ccc; padding: 5px;margin-top: 10px;" class="field-group">'+make_toolbar(),l="</div>",c="",u="";c+=f;for(var h in o){var p=o[h];u=u+'<input type="text" id="'+p.id+"_"+e.unique+'" placeholder="'+p.title+'" value="" class="'+p.id+'" data-field-id="'+p.id+'" size="30" /><br/>'}c=c+u+l;i.append(c);n&&r(".field-group:last").hide().insertAfter(n).fadeIn("300");jQuery(".multi-input .field-group input").keyup(function(e,t){update_all_fields({index:e})})}function add_input(e){return!1}function process_current_fields(e){var t=jQuery,n=t(".multi-input-field").val(),r=t.parseJSON(convert_to_quotes(n)),i=t.parseJSON(t(".multi-input-field").attr("data-fields")).length,s=r?r.length/i:0;if(r){for(var o=0;o<s;o++)add_empty_fields({unique:o});var o=0,u=0;t.each(r,function(e,n){var r=t("#"+n.id+"_"+u),s=n.value!=n.id?n.value:"";r.val(s);if(o===i-1){u++;o=0}else o++})}}function update_all_fields(){var e=jQuery,t=e(".multi-input input"),n=e(".field-group"),r=e(".multi-input-field"),i="[";r.val("");e.each(n,function(n,r){e.each(e("input",r),function(t,r){var s=e(r).attr("data-field-id"),o=e(r).val(),u=n===0&&t===0?"":",";o?i=i+u+"{|id|:|"+s+"|,|value|:|"+o+"|}":i=i+u+"{|id|:|"+s+"|,|value|:|"+s+"|}"});var s=t.length-1});i+="]";r.val(r.val()+i)}function make_toolbar(){var e=jQuery,t='<ul class="multi-toolbar"><li><button type="button" onClick="return false" class="move-up"> &uarr; </button></li><li><button type="button" onClick="return false" class="move-down"> &darr; </button></li><li><button type="button" onClick="return false" class="add-group">+</button></li><li><button type="button" onClick="return false" class="delete-group"> - </button></li></ul>';return t}function setup_toolbars(){jQuery(".move-up").live("click",move_group_up);jQuery(".move-down").live("click",move_group_down);jQuery(".add-group").live("click",add_group);jQuery(".delete-group").live("click",delete_group)}function move_group_up(){var e=jQuery(this).closest(".field-group");e.insertBefore(e.prev());update_all_fields();var t=e.css("background-color");e.animate({backgroundColor:"yellow"});e.animate({backgroundColor:t})}function move_group_down(){var e=jQuery(this).closest(".field-group");e.insertAfter(e.next());update_all_fields();var t=e.css("background-color");e.animate({backgroundColor:"yellow"});e.animate({backgroundColor:t})}function add_group(){add_empty_fields({unique:undefined,location:jQuery(this).closest(".field-group")})}function delete_group(){var e=jQuery(this).closest(".field-group");e.fadeOut(500,function(){e.remove();update_all_fields()})}function convert_to_quotes(e){return e.replace(/(\|)/g,'"')}function convert_from_quotes(e){return e.replace(/(\")/g,"|")}jQuery(document).ready(function(){set_up_form();setup_toolbars();jQuery(".multi-input .field-group input").keyup(function(e,t){update_all_fields()})});